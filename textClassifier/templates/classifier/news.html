
{% load staticfiles %}
<!DOCTYPE html>
<!-- saved from url=(0049)https://getbootstrap.com/docs/4.3/examples/album/ -->
<html lang="en" class="gr__getbootstrap_com">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v3.8.5">
    <title>Album example · Bootstrap</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.3/examples/album/">

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>
    <!-- Custom styles for this template -->
    <link href="{% static 'textClassifier/style.css' %}" rel="stylesheet">
  </head>


<body data-gr-c-s-loaded="true">

<header>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <a class="navbar-brand" href="https://getbootstrap.com/docs/4.0/examples/navbars/#">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true" class="mr-2" viewBox="0 0 24 24" focusable="false"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
      <strong>Explain Anything</strong>      
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarsExample04">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="/classifier">Restaurant</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/classifier/news">News</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="http://example.com/" id="dropdown04" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Help</a>
          <div class="dropdown-menu" aria-labelledby="dropdown04">
            <a class="dropdown-item" href="https://getbootstrap.com/docs/4.0/examples/navbars/#">Action</a>
            <a class="dropdown-item" href="https://getbootstrap.com/docs/4.0/examples/navbars/#">Another action</a>
            <a class="dropdown-item" href="https://getbootstrap.com/docs/4.0/examples/navbars/#">Something else here</a>
          </div>
        </li>
      </ul>
    </div>
  </nav>
</header>

<main role="main" class = "bd-content shadow-lg" >
  <section class="jumbotron text-center">
    <div class="container">
      <h1 class="jumbotron-heading">Categorize the News</h1>
      <p class="lead text-muted">Give the headline, find the categories of your news.</p>

      <div class="row">
        <div class = "col-sm-6">
            <div class="input-group input-group-lg shadow">
              <div class="input-group-prepend">
                <span class="input-group-text bg-dark text-white">Input</span>
              </div>
                {% csrf_token %}
              <textarea onKeyPress="return charLimit(this)" placeholder="{{ result }}" onKeyUp="return characterCount(this)"  rows="8" class="form-control" aria-label="With textarea" id="input_text" name = "input_text"></textarea>
              
            </div>
            <p class="text-right text-black-50"><strong><span id="charCount">100</span></strong> more characters available.</p>        
            <div class="row p-sm-3">
              <div class="col-sm-6 text-left ">
                <button type="button" onclick="submitText();" class="btn btn-dark btn-block">Predict</button>
              </div>
              <div class="col-sm-6 text-right">
                <button type="button" class="btn btn-outline-dark btn-block" onclick="clearText(this);">Clear</button>      
              </div>
            </div>
        </div>
          
        <div class = "col-sm-6">


          <div class = "w-auto text-left" style = "font-size:120%"  id = "label-container">
              <span class="badge badge-primary d-none"  id = "label0"> </span>
              <span class="badge badge-warning d-none" id = "label1"> </span>
              <span class="badge badge-success d-none"  id = "label2"> </span>
              <span class="badge badge-danger d-none" id = "label3"> </span>
              <span class="badge badge-dark d-none" id = "label4"> </span>
          </div>


          <p class="pt-sm-4 text-left">
            <a class="btn btn-outline-dark" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
              Explanation
            </a>
            <div class="collapse.show" id="collapseExample">
              <div class="card card-body" id = "explanation">
                {{ explanation }}
              </div>
            </div>
          </p>
          
          <div class="row"> 
            <div class="col-sm-6">
              <div class="toast" role="alert" data-autohide="false" aria-live="assertive" aria-atomic="true" id="toast-conclusion">
                <div class="toast-header">
                <svg class="bd-placeholder-img rounded mr-2" width="20" height="20" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img"><rect fill="#007aff" width="100%" height="100%"></rect></svg>
                  <strong class="mr-auto">Conclusion</strong>
                  <small>11 mins ago</small>
                  <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="toast-body">
                 
                </div>
              </div>              
            </div>
            <div class="col-sm-6">
              <div class="toast" role="alert" data-autohide="false" aria-live="assertive" aria-atomic="true" id="toast-confidence">
                <div class="toast-header">
                <svg class="bd-placeholder-img rounded mr-2" width="20" height="20" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img"><rect fill="#007aff" width="100%" height="100%"></rect></svg>
                  <strong class="mr-auto">Bootstrap</strong>
                  <small>11 mins ago</small>
                  <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="toast-body">
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-auto">
              <div class="toast" style="max-width: 900px" role="alert" data-autohide="false" aria-live="assertive" aria-atomic="true" id="toast-chart">
                <div class="toast-header">
                <svg class="bd-placeholder-img rounded mr-2" width="20" height="20" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img"><rect fill="#007aff" width="100%" height="100%"></rect></svg>
                  <strong class="mr-auto">Bootstrap</strong>
                  <small>11 mins ago</small>
                  <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="toast-body">
                    <canvas id="myChart" width="1200" height="600"></canvas>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </section>

</main>

<footer class="text-muted">
  <div class="container">
    <p class="float-right">
      <a href="https://getbootstrap.com/docs/4.3/examples/album/#">Back to top</a>
    </p>
    <p>Album example is © Bootstrap, but please download and customize it for yourself!</p>
    <p>New to Bootstrap? <a href="https://getbootstrap.com/">Visit the homepage</a> or read our <a href="https://getbootstrap.com/docs/4.3/getting-started/introduction/">getting started guide</a>.</p>
  </div>
</footer>


<script src="https://code.jquery.com/jquery-3.1.1.min.js"  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>

<script>

$(function () {
  $('[data-toggle="popover"]').popover()
})

$('.popover-dismiss').popover({
  trigger: 'focus'
})


$('body').on("keydown", "#input_text",function(e) {
    if (e.which == 13) {
      submitText();
    }
});


$('#input_text').each(function () {
  this.setAttribute('style', 'height:' + (this.scrollHeight) + 'px;overflow-y:hidden;');
}).on('input', function () {
  this.style.height = 'auto';
  this.style.height = (this.scrollHeight) + 'px';
});


var maxLength=140;
function charLimit(el) {
    if (el.value.length > maxLength) return false;
    return true;
}
function characterCount(el) {
    var charCount = document.getElementById('charCount');
    if (el.value.length > maxLength) el.value = el.value.substring(0,maxLength);
    if (charCount) charCount.innerHTML = maxLength - el.value.length;
    return true;
}

function clearText(el) {
  $('#input_text').val("");
  characterCount(el);
}

function fillbackTextArea(data) {
  $("#input_text").val(data["input_text"]);   
}

function drawResult(data) {
    var labels = data['labels'];
    $.each(labels, function(idx, l) {
        var badge = $('#label'+idx);
        badge.text(l[0]);
        badge.removeClass('d-none');
    });
}

function procConclusionToast(data) {
  var res = "POLITICS";
  var res_sent = "The label is %res%.".replace("%res%",res);
  console.log(res_sent);
  $("#toast-conclusion .toast-body").text(res_sent);
  $("#toast-conclusion").toast("show");
}

probab_data = {
    datasets: [{
        data: [1,2,3,4,5,
        1,2,3,4,5,
        1,2,3,4,5,
        1,2,3,4,5,
        1,2,3,4,5,6,
        1,2,3,4,5,],
        backgroundColor:
            ['rgba(255,0,0,1)', 'rgba(255,99,71,1)', 'rgba(255,127,80,1)', 'rgba(250,128,114,1)', 'rgba(255,165,0,1)',
            'rgba(255,215,0,1)', 'rgba(218,165,32,1)', 'rgba(189,183,107,1)', 'rgba(128,128,0,1)', 'rgba(255,255,0,1)',
            'rgba(154,205,50)', 'rgba(107,142,35)', 'rgba(127,255,0,1)', 'rgba(50,205,50,1)', 'rgba(152,251,152,1)',
            'rgba(102,205,170,1)', 'rgba(0,255,255,1)', 'rgba(64,224,208,1)', 'rgba(175,238,238)', 'rgba(95,158,160,1)',
            'rgba(100,149,237)', 'rgba(0,191,255)', 'rgba(135,206,235,1)', 'rgba(0,0,128,0.8)', 'rgba(65,105,225,1)', 'rgba(138,43,226,1)',
            'rgba(106,90,205,1)', 'rgba(128,0,128,1)', 'rgba(219,112,147,1)', 'rgba(255,192,203,1)', 'rgba(210,105,30,1)',
            {#"tomato", "dark salmon", "salmon", "dark orange",#}
            {#"gold", "golden rod", "dark khaki", "olive", "yellow",#}
            {#"yellow green", "olive drab", "chart reuse", "dark green", "sea green",#}
            {#"medium aqua marine", "aqua", "turquoise", "pale turquoise", "cadet blue",#}
            {#"corn flower blue", "deep sky blue", "sky blue", "navy", "royal blue", "blue violet",#}
            {#"slate blue", "purple", "pale violet red", "pink", "saddle brown"#}
        ]
    }],

    // These labels appear in the legend and in the tooltips when hovering different arcs
    labels: ['ARTS', 'ARTS & CULTURE', 'BLACK VOICES', 'BUSINESS', 'COLLEGE',
       'COMEDY', 'CRIME', 'EDUCATION', 'ENTERTAINMENT', 'FIFTY',
       'GOOD NEWS', 'GREEN', 'HEALTHY LIVING', 'IMPACT', 'LATINO VOICES',
       'MEDIA', 'PARENTS', 'POLITICS', 'QUEER VOICES', 'RELIGION',
       'SCIENCE', 'SPORTS', 'STYLE', 'TASTE', 'TECH', 'THE WORLDPOST',
       'TRAVEL', 'WEIRD NEWS', 'WOMEN', 'WORLD NEWS', 'WORLDPOST'],

};

function procPieChartsToast(data) {
    probab_data.datasets[0].data = data['prob'];
    var ctx =$('#myChart');
    var myPieChart = new Chart(ctx, {
        type: 'doughnut',
        data: probab_data,
        options: {
          {#responsive: false,#}
          legend: {
             display: false,
             position: 'bottom',
             fontSize: 3,
             {#onClick: null#}
          },
          title: {
            display: true,
            text: 'Predicted probabilities of each category'
          }
        }

    });
    $('#toast-chart').toast("show");
}

//submission code
function submitText(){
  if ($("#input_text").val().length == 0) {
      {#alert("Put some news headline here.");#}
  }
  else {
      var text = $('#input_text').val();

      $.ajax({
        type: "POST",
        url: "{% url 'classifier:predict_news' %}",
        data: {"input_text":text},
        dataType: "json",
        success: function (data) {
          console.log('Submission was successful.');
          console.log(data["input_text"]);
          $('#explanation').text(data["explanation"]); //experimental
          fillbackTextArea(data);

          drawResult(data);
          procConclusionToast(data);
          procPieChartsToast(data);

        },
        error: function (data) {
          console.log('An error occurred.');
          console.log(data);
        },
      });
  }
}


</script>

</body>
</html>